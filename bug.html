<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" href="https://apps.bdimg.com/libs/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        .container th, .container td{
            width: 5%;
        }
        .btnActive{
            background-color: #E6E6E6;
        }
        .form-control, .btn{
            height: 5vh;
        }
        span, select, button, input{
            font-size: 18px!important;
        }

    </style>
</head>
<body>
    <div class="container" style="width: 100%;">
        <div>
            <form class="bs-example bs-example-form" role="form" id="user" style="margin-top: 10px;">
                <div class="input-group col-md-4 col-xs-12">
                    <span class="input-group-addon">　区服　</span>
                    <select id="userArea" class="form-control">
                        <option value="4399;4399a;h5">4399</option>
                        <option value="sina;combination;h5">微博</option>
                        <option value="qunhei;combination;h5">群黑</option>
                        <option value="4177;17k;h5">4177</option>
                        <option value="wx;wx;h5qq">微信</option>
                        <option value="wb;wb;h5qq">空间</option>
                    </select>
                </div>
                <br>
                <div class="input-group col-md-4 col-xs-12">
                    <span class="input-group-addon">　ID　</span>
                    <input type="text" class="form-control" id="userId">
                </div>
                <br>
                <div class="input-group col-md-4 col-xs-12">
                    <span class="input-group-addon">session</span>
                    <input type="text" class="form-control" id="userSession">
                </div>
                <br>
            </form>
            <div class="input-group col-md-4 col-xs-12">
                <input type="text" class="form-control" id="skillId" placeholder="输入武功id">
                <span class="input-group-btn">
                        <button class="btn btn-default" type="button" onclick="learnSkill()">学习技能</button>
                    </span>
            </div><!-- /input-group -->
            <br>
            <div class="input-group col-md-4 col-xs-12">
                <input type="text" class="form-control" id="teacherId" placeholder="输入师傅id">
                <span class="input-group-btn">
                        <button class="btn btn-default" type="button" onclick="changeTeacher()">　拜师　</button>
                    </span>
            </div>
            <br>
            <div class="input-group col-md-4 col-xs-12">
                <input type="text" class="form-control" id="itemId" placeholder="输入物品id">
                <span class="input-group-btn">
                        <button class="btn btn-default" type="button" onclick="getItem()">拾取物品</button>
                    </span>
            </div>
            <br>
            <div class="input-group col-md-4 col-xs-12" style="margin-bottom: 20px;">
                <input type="text" class="form-control" id="merchantItemId" placeholder="粘贴黑商物品id">
                <span class="input-group-btn">
                        <button class="btn btn-default" type="button" onclick="buyMerchant()">购买黑商</button>
                    </span>
            </div>
            <div class="input-group col-md-4 col-xs-12">
                <span class="input-group-addon">获取次数</span>
                <input type="number" class="form-control" id="checkNum" max="100">
            </div>
            <div class="input-group col-md-4 col-xs-12" style="margin-bottom: 10px;">
                <input type="text" class="form-control" id="encryptData" placeholder="粘贴密文">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button" onclick="checkRlt()">获取物品</button>
                </span>
            </div>
        </div>
        <button class="btn btn-primary" onclick="startMission()" style="margin:5px 5px;">南阳</button>
        <button class="btn btn-primary" onclick="getYB()" style="margin:5px 5px;">广告</button>
        <button class="btn btn-info" onclick="getMerchant()" style="margin:5px 5px;">黑商</button>
        <button class="btn btn-info" onclick="getEncryptedData()" style="margin:5px 5px;">测试</button>

        <br>
        <h4>返回结果</h4>
        <div id="result" style="margin-top:10px;width:300px; height: 200px; border-top: 1px solid lightgray;">

        </div>
    </div>





</body>

</html>

<script>
        var test = function(){
            console.log($("#userArea").val().split(';')[0]);
        };

        var merchantList, items;
        
        var getApiBase = function(){
            return $("#userArea").val().split(';')[1]
        };
        
        var getHttpBase = function(){
            return $("#userArea").val().split(';')[2]
        };
        
       

        var getItemJson = function(type){
            $.ajax({
                type: "GET",
                url: "https://cdn.mkjump.com/fzjh/0.118/res/Json/item.json",
                success: function(result) {
                    items = result;
                    getItemStoreJson()
                }
            });
        };

        var getItemStoreJson = function(type){
            $.ajax({
                type: "GET",
                url: "https://cdn.mkjump.com/fzjh/0.120/res/Json/itemEquip.json",
                success: function(result) {
                    $.extend(items, result)
                }
            });
        };
        getItemJson();




        var  setHeader = function (request) {
            request.setRequestHeader('Content-Type', 'text/plain;charset=UTF-8');
            request.setRequestHeader('userid', $("#userId").val());
            request.setRequestHeader('channel', $("#userArea").val().split(';')[0]);
            request.setRequestHeader('session', $("#userSession").val());
            request.setRequestHeader('Accept', '*/*');
            request.setRequestHeader('Accept-Language', 'zh-CN,zh;q=0.9');
        };

        //统一调用的post请求
        var httpPost = function(cmd, data, callBack){
            $.ajax({
                type: "POST",
                url: "https://"+ getHttpBase() +".mkjump.com/" + getApiBase() +"/api/h5/" + cmd,
                data: JSON.stringify(data),
                beforeSend: function(request) {
                    setHeader(request);
                },
                success: function(result) {
                    $("#result").text(result);
                    callBack(result);
                }
            });
        };


        var getEncryptedData = function(fbId, rltId){

            var form = new FormData(document.querySelector("form"));
            form.append("rlt", $("#rltId").val());
            form.append("fb", $("#fbId").val());
            form.append("userid", $("#userId").val());
            form.append("session", $("#userSession").val());
            form.append("channel", $("#userArea").val().split(';')[0]);
            //$("#rltId").val()
            //            $("#fbId").val()
            $.ajax({
                type: "POST",
                url: "http://119.29.38.201/encrypt",
                data: form,
                processData : false,
                // 告诉jQuery不要去设置Content-Type请求头
                contentType : false,
                beforeSend: function(request) {
                    setHeader(request);
                },
                success: function(result) {
                    console.log(result);
                    checkRlt(result)
                }
            });
        };


        var checkRlt = function(){
            var data = JSON.parse($("#encryptData").val());
            for(var i=0; i< $("#checkNum").val(); i++){
                httpPost("check_rlt", data, function(){

                })
            }

        };


        //南阳任务
        var startMission = function(){
            var data = {"type":3};
            httpPost("finish_mission", data, function(){

            })
        };

        //看广告
        var getYB = function(){
            var data = {"ad":1};
            httpPost("share_reward", data, function(){

            })
        };

        //学习技能
        var learnSkill = function(){
            var data = {"level": 10,"skill_id": $("#skillId").val()};
            httpPost("learn_skill", data, function(){

            })

        };

        //拜师
        var changeTeacher = function(){
            var data = {"teacher_id": $("#teacherId").val()};
            httpPost("baishi", data, function(){

            })

        };

        //拾取物品
        var getItem = function(){
            var data = {"itemId": $("#itemId").val(), "count": 10};
            httpPost("get_item", data, function(){

            })

        };


        //查看黑商
        var getMerchant = function(){
            var data = {"merchantId" : "BM", "type" : 1};
            httpPost("get_merchant_list", data, function(result){
                merchantList = JSON.parse(result).data.list;
                for(var i=0; i<merchantList.length;i++){
                    merchantList[i]["name"] = items[merchantList[i].itemId].name;
                    delete merchantList[i].type;
                    delete merchantList[i].count;

                }
                $("#result").text(JSON.stringify(merchantList));
            });

        };

        //购买黑商
        var buyMerchant = function(){

            var data = {
                    "itemId" : $("#merchantItemId").val(),
                    "loc" : 1,
                    "type" : 1,
                    "merchantId" : "BM"
                };
            httpPost("buy_merchant_item", data, function(result){

            });

        };




</script>